<div class="container mt-5">
    <div class="row justify-content-center">
		<div class="col-12 text-center">
			<h1>Let's Talk About The Crime Wave</h1>
        </div>
        <div class="col-12 col-lg-8 mt-4 text-lg">
            <p>Much has been made of the crime wave here in Atlanta. It's been a concern for citizens, a political football, and used as a reason for drastic changes like breaking the city itself apart.</p>
            <p><b>Let's take a look at what the data can tell us!</b></p>
            <p>First though, let's start with an important note. Data adds to our understanding, and gives us important contexts. But as we look at trends, we do well to remember them in their full context: a story of lives interrupted with fear and tragedy, not just a string of data points.</p>
        </div>
        <div class="col-12"><hr></div>
        <div class="col-12 col-lg-8 mt-5 text-center">
            <h2>The Wave</h2>
        </div>
        <div class="col-12 mt-3">
            <div class="block">
                <div class="title text-center">2019 - 2021 Aggravated Assaults & Homicides Per Capita</div>
                <div class="content">
                    <div class="chart">
                        <canvas id="crimeWaveChart" width="400" height="200"></canvas>
                    </div>
                    <p class="text-end"><small><a href="https://www.atlantapd.org/i-want-to/crime-data-downloads" target="_blank">Source: APD Crime Data</a>
                    <a href="https://worldpopulationreview.com/us-cities/atlanta-ga-population" target="_blank">US Census Yearly Population Estimates</a></small></p>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-8 mt-4 text-lg">
            <p>Now this is a carefully curated chart, showing only the details highlighted repeatedly in popular discussions.</p>
            <p>Aggravated Assaults increased an average of 11% per year from 2019 to 2021, and Homicides increased about 21.5% per year over the same period! No wonder people are scared!</p>
            <p>But, as with most things, context can be helpful here! First, let's zoom out a little.</p>
        </div>
        <div class="col-12 mt-4">
            <div class="block">
                <div class="title text-center">2009 - 2021 Crime Trends Per Capita</div>
                <div class="content">
                    <div class="chart">
                        <canvas id="crimeChart" width="400" height="200"></canvas>
                    </div>
                    <p class="text-end"><small><a href="https://www.atlantapd.org/i-want-to/crime-data-downloads" target="_blank">Source: APD Crime Data</a>
                    <a href="https://worldpopulationreview.com/us-cities/atlanta-ga-population" target="_blank">US Census Yearly Population Estimates</a></small></p>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-8 mt-4 text-lg">
            <p>Now we have some better context. Most crime is continuing to decrease significantly each year, and many of the heart-stopping spikes now look almost tame compared to numbers just a few years prior.</p>
            <p>Aggravated Assaults were <b>higher as recently as 2014</b>. Homicides are still relatively low as a historical trend, but have been increasing since 2017, and the rate of increase <b>nearly plateaued in 2021</b>.</p>
            <p>We also see why those using crime to sell papers or politics are only using anecdotes and very narrow statistics. It's misleading to give the relative increase of only one type of crime without also explaining that is an increase from what was the <b>lowest crime rate in at least 3 decades</b>.</p>
        </div>
        <div class="col-12"><hr></div>
        <div class="col-12 col-lg-8 mt-5 text-center">
            <h2>Factors & Myths</h2>
        </div>
        <div class="col-12 col-lg-8 mt-3 text-lg">
            <p>So what are the causes? What can we do about it?</p>
            <p>Proposed causes and solutions, far too often, fall along partisan lines and are presented as easy, obvious, and simple. Reality is rarely so simple though.</p>
            <p>Let's review some popular notions and see whether the data bears them out?</p>
        </div>
        <div class="col-12 mt-5 text-center">
            <h3>1. Did Crime Increase Because of Fewer Cops?</h3>
        </div>
        <div class="col-12 mt-3">
            <div class="block">
                <div class="title text-center">2009 - 2021 Crime Per Capita Vs Officers Per Capita</div>
                <div class="content">
                    <div class="chart">
                        <canvas id="crimeVsOfficerChart" width="400" height="200"></canvas>
                    </div>
                    <p class="text-end"><small><a href="https://www.atlantapd.org/i-want-to/crime-data-downloads" target="_blank">Source: APD Crime Data</a> | <a href="https://crime-data-explorer.fr.cloud.gov/pages/le/pe" target="_blank">FBI CDE Officer Employment</a></small></p>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-8 mt-4 text-lg">
            <p>There is no direct correlary between the number of cops we have on the streets and the number of crimes.</p>
            <p>This is unsurprising. Studies have shown that <a href="" target="_blank">crime has decreased</a> over the last several decades regardless of <a href="https://www.ojp.gov/ncjrs/virtual-library/abstracts/relationship-between-police-presence-and-crime-deterrence" target="_blank">head counts.</a> <a href="https://www.washingtonpost.com/politics/2020/06/07/over-past-60-years-more-spending-police-hasnt-necessarily-meant-less-crime/" target="_blank">Spending doesn't have a direct correlation either.</a></p>
            <p>Cops serve important civil functions, and many find an increased presence of cops comforting. But cops are not the only factor in crime rates. To the extent they are a factor, it's far more important <b>how</b> officers are deployed, and <b>what tools</b> they are given.</p>
            <p>Violent altercations amongst friends, nearly 1,800 guns being stolen from the cars of irresponsible gun owners, these are things no number of cops will completely prevent. Our safety is dependent on far more social factors than just enforcement.</p>
        </div>
        <div class="col-12"><hr></div>
        <div class="col-12 mt-5 text-center">
            <h3>2. Did Crime Increase In 2020 Because Of Protests?</h3>
        </div>
        <div class="col-12 mt-3">
            <div class="block">
                <div class="title text-center">2009 - 2021 Aggravated Assaults & Homicides Per Capita</div>
                <div class="content">
                    <div class="chart">
                        <canvas id="crimeWaveChart2" width="400" height="200"></canvas>
                    </div>
                    <p class="text-end"><small><a href="https://www.atlantapd.org/i-want-to/crime-data-downloads" target="_blank">Source: APD Crime Data</a>
                    <a href="https://datacommons.org/tools/timeline#statsVar=UnemploymentRate_Person&place=geoId%2F13&chart=%7B%22unemploymentRate%22%3A%7B%22delta%22%3Afalse%7D%7D" target="_blank">BLS Unemployment</a></small></p>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-8 mt-4 text-lg">
            <p>In the two areas that did see increases, the trends started increasing from 2018, long before the protests in 2020.</p>
            <p>Did trends shift in 2020? Yes! <b>So did many other factors that year.</b> Such as unemployment, homelessness, social fear, 100's of thousands of deaths from a pandemic, and political fears.</p>
            <p>APD also has indicated a significant increase in violence and killings stemming from domestic disputes between friends and acquaintances.</p>
            <p>Any narrative attributing the changes in crime to a single factor can be dismissed as embarrasingly reductive, or worse, intentionally misleading.</p>
        </div>
        <div class="col-12 mt-3">
            <div class="block">
                <div class="title text-center">2019 vs 2020 Violent Crime Per Capita w/ 2020 % Unemployment & Primary Protest Window</div>
                <div class="content">
                    <div class="chart">
                        <canvas id="crimeProtestsChart" width="400" height="200"></canvas>
                    </div>
                    <p class="text-end"><small><a href="https://www.atlantapd.org/i-want-to/crime-data-downloads" target="_blank">Source: APD Crime Data</a></p>
                </div>
            </div>
        </div>
        <div class="col-12"><hr></div>
        <div class="col-12 mt-5 text-center">
            <h3>2. Are Atlanta Citizens Unsafe In Their Own City?</h3>
        </div>
        <div class="col-12 col-lg-8 mt-4 text-lg">
            <p>No. The increases we've seen do not suggest that we are in far more danger today than we were in say 2019.</p>
            <p>Let's look at our risk as a percentage per capita.</p>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-6 col-lg-3 text-center my-4">
            <div class="kpi py-4">
                <div class="value">{homicideRisk[2019]}%</div>
                <div class="label">2019 Homicide Risk</div>
            </div>
        </div>
        <div class="col-6 col-lg-3 text-center my-4">
            <div class="kpi py-4">
                <div class="value">{homicideRisk[2020]}%</div>
                <div class="label">2020 Homicide Risk</div>
            </div>
        </div>
        <div class="col-6 col-lg-3 text-center my-4">
            <div class="kpi py-4">
                <div class="value">{assault[2019]}%</div>
                <div class="label">2019 Agg. Assault Risk</div>
            </div>
        </div>
        <div class="col-6 col-lg-3 text-center my-4">
            <div class="kpi py-4">
                <div class="value">{assault[2020]}%</div>
                <div class="label">2020 Agg. Assault Risk</div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8 mt-4 mb-5 text-lg">
            <p>Even as concerning as the increases may be, the increase in risk to any given citizen is practically a rounding error on what was already a low risk.</p>
        </div>
        <div class="col-12"><hr></div>
        <div class="col-12 mt-5 text-center">
            <h2>Conclusion</h2>
        </div>
        <div class="col-12 col-lg-8 mt-4 mb-5 text-lg">
            <p>So what does the data tell us? It suggests that in a tumultuous period, we've seen a small increase after decades of decreasing crime. We've seen that there is no one simple cause, and no one simple solution.</p>
            <p><b>The data helps us separate legitimate concerns from fearmongering.</b></p>
            <p>From there, we go beyond the data. We bring our assumptions about human motivations and behaviors. <b>Assumptions that may be wrong, or incredibly limited.</b> Keeping an open mind and listening to experts would serve us well.</p>
            <p>We would do well to challenge our own ideas around <a href="https://kurious.io/c/risk/#intro" target="_blank">risk</a>, and <a href="https://kurious.io/c/poor-lazy/" target="_blank">poverty</a> for instance.</p>
            <p>One particularly illuminating local voice on this topic is George Chidi. He has done the work, and amplifies the experts. Here are a few relevant articles of his that should be required reading for anyone interested in working towards a safer Atlanta.</p>
            <p><a href="https://theatlantaobjective.substack.com/p/hitting-close-to-home" target="_blank">Hitting Close To Home</a></p>
            <p><a href="https://theatlantaobjective.substack.com/p/the-thomas-abt-interview" target="_blank">Ten Steps to Stop The Killing</a></p>
            <p><a href="https://www.atlantamagazine.com/great-reads/the-source-of-violent-crime-in-atlanta-isnt-mysterious-its-desperation-born-by-inequality/" target="_blank">The source of violent crime in Atlanta isnâ€™t mysterious</a></p>
            <p><a href="https://theatlantaobjective.substack.com/p/why-theyre-all-black" target="_blank">Why They're All Black</a></p>
            <p>And let's not use our fear of crime as a distraction from the immense amount of actual suffering our neighbors deal with every day: <a href="https://theatlantaobjective.substack.com/p/downtown-dis-harmony">Downtown Dis-Harmony</a></p>
        </div>
    </div>
</div>
<style>
    .text-lg {
        font-size: 1.5rem;
        line-height: 1.7;
    }
    .chart {
        height: 700px;
    }
    @media only screen and (max-width: 640px) {
        .text-lg {
            font-size: 1.1rem;
        }
        .chart {
            height: 500px;
        }
    }
</style>

<script>
    // export let ready;
    import Chart from "chart.js/auto/auto.esm";
    import annotationPlugin from 'chartjs-plugin-annotation';
    import { get } from "$lib/_helpers";
    import { onMount } from 'svelte';
    import { browser } from "$app/env";
    
let domain = 'https://civics.city/atlanta/data';
var assault = {
    2019: 0,
    2020: 0
};
var homicideRisk = {
    2019: 0,
    2020: 0
};
onMount(() => {
    init();
});
var crimeWave = {};

function init() {
    if( browser )
    {
        Chart.register(annotationPlugin);
        var population = {
            2021: 524100,
            2020: 515400,
            2019: 506800,
            2018: 498200,
            2017: 491700,
            2016: 479200,
            2015: 468300,
            2014: 461200,
            2013: 454000,
            2012: 449000,
            2011: 437800,
            2010: 429400,
            2009: 428000
        };
        var officerCount = {
            "2009":1881,
            "2010":1973,
            "2011":2069,
            "2012":2165,
            "2013":2294,
            "2014":2209,
            "2015":2218,
            "2016":2140,
            "2017":2087,
            "2018":1987,
            "2019":2090,
            "2020":2015,
            "2021":1603
        };

        get( domain+'/COBRA/year-aggregate.json', function(data) 
        {
            var yearKeys = Object.keys(data);
            var datasets = {};
            var totalCrimes = {};
            yearKeys.forEach((yearKey) => {
                var year = data[yearKey];
                totalCrimes[yearKey] = 0;
                Object.keys(year.sum).forEach((crimeKey) => {
                    if( ['ROBBERY-RESIDENCE', 'ROBBERY-PEDESTRIAN', 'ROBBERY-COMMERCIAL'].indexOf(crimeKey) != -1 )
                    {
                        if( !year.sum.hasOwnProperty('ROBBERY') )
                        {
                            year.sum.ROBBERY = 0;
                        }
                        year.sum.ROBBERY += year.sum[crimeKey];
                        delete year.sum[crimeKey];
                    }
                    if( ['BURGLARY-RESIDENCE', 'BURGLARY-NONRES'].indexOf(crimeKey) != -1 )
                    {
                        if( !year.sum.hasOwnProperty('BURGLARY') )
                        {
                            year.sum.BURGLARY = 0;
                        }
                        year.sum.BURGLARY += year.sum[crimeKey];
                        delete year.sum[crimeKey];
                    }
                    
                });
                Object.keys(year.sum).forEach((crimeKey) => {
                    var crime = year.sum[crimeKey];
                    var val = crime/population[yearKey]*10000;
                    totalCrimes[yearKey] += val;
                    if( !datasets.hasOwnProperty(crimeKey) )
                    {
                        datasets[crimeKey] = { label: crimeKey, data: [], tension: 0.2 };
                        if( [ 'AGG ASSAULT', 'HOMICIDE'].indexOf(crimeKey) != -1 ) {
                            crimeWave[crimeKey] = { label: crimeKey, data: [], tension: 0.2 };
                        }
                        
                    }

                    datasets[crimeKey].data.push([yearKey, val]);

                    if( ['2019', '2020', '2021'].indexOf(yearKey) != -1
                        && [ 'AGG ASSAULT', 'HOMICIDE'].indexOf(crimeKey) != -1 )
                    {
                        crimeWave[crimeKey].data.push([yearKey, val]);
                    }
                })
                // datasets.push([year[0], sum])
            });
            // console.log(Object.values(datasets));
            console.log({crimeWave});
            function capitaToPercent(val, year) {
                var p = (val*10000)/population[year];
                
                return p.toFixed(2);
            }
            homicideRisk[2019] = capitaToPercent( crimeWave['HOMICIDE'].data[0][1], 2019 );
            homicideRisk[2020] = capitaToPercent( crimeWave['HOMICIDE'].data[1][1], 2020 );
            assault[2019] = capitaToPercent( crimeWave['AGG ASSAULT'].data[0][1], 2019 );
            assault[2020] = capitaToPercent( crimeWave['AGG ASSAULT'].data[1][1], 2020 );
            Chart.defaults.color = 'white';
            Chart.defaults.font.size = 16;
            Chart.overrides.line.borderColor = [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(153, 192, 86, 1)',
                'rgba(75, 162, 132, 1)',
                'rgba(255, 102, 64, 1)',
                'rgba(54, 192, 64, 1)',
                'rgba(255,255,255, 1)',
                'rgba(0, 99, 255, 1)',
                'rgba(255, 0, 126, 1)'
            ];

            var ctx = document.querySelector('#crimeChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(data),
                    datasets: Object.values(datasets)
                },
                options: {
                    maintainAspectRatio: false,
                    elements: {
                        point: {
                            borderColor: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                text: 'Police Incidents per 10,000',
                                display: true
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 40
                            }
                        }
                    }
                }
            });

            var ctx = document.querySelector('#crimeWaveChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2019', '2020', '2021'],
                    datasets: Object.values(crimeWave)
                },
                options: {
                    maintainAspectRatio: false,
                    elements: {
                        point: {
                            borderColor: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                text: 'Police Incidents per 10,000',
                                display: true
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 40
                            }
                        }
                    }
                }
            });
            delete datasets['AUTO THEFT'];
            delete datasets['LARCENY-FROM VEHICLE'];
            delete datasets['LARCENY-NON VEHICLE'];
            delete datasets['ROBBERY'];
            delete datasets['BURGLARY'];
            delete datasets['MANSLAUGHTER'];
            var ctx = document.querySelector('#crimeWaveChart2').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(data),
                    datasets: Object.values(datasets)
                },
                options: {
                    maintainAspectRatio: false,
                    elements: {
                        point: {
                            borderColor: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                text: 'Police Incidents per 10,000',
                                display: true
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 40
                            }
                        }
                    }
                }
            });
            
    // console.log({totalCrimes})
            Object.keys(officerCount).forEach((key) => {
                officerCount[key] = officerCount[key]/population[key]*10000;
            })

            var ctx = document.querySelector('#crimeVsOfficerChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(totalCrimes),
                    datasets: [ {
                        yAxisID: 'yAxis2',
                        label: 'Total Crimes',
                        data: Object.values(totalCrimes)
                    },
                    {
                        yAxisID: 'yAxis',
                        label: 'Officers Per Capita',
                        data: Object.values(officerCount)
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    elements: {
                        point: {
                            borderColor: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    scales: {
                        yAxis: {
                            beginAtZero: true,
                            max: 55,
                            position: 'right',
                            title: {
                                text: 'Officers per 10,000',
                                display: true,
                                color: 'rgba(54, 162, 235, 1)'
                            }
                        },
                        yAxis2: {
                            beginAtZero: true,
                            max: 1000,
                            title: {
                                text: 'Police Incidents per 10,000',
                                display: true
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 40
                            }
                        }
                    }
                }
            });
        });

        var promises = [];
        var processData = function(data, prefix) {
            var monthKeys = Object.keys(data).sort();
            var datasets = {};
            var keys = [ 'AGG ASSAULT', 'HOMICIDE'];

            monthKeys.forEach((monthKey) => {
                var month = data[monthKey];

                Object.keys(month.sum).forEach((crimeKey) => {
                    var crime = month.sum[crimeKey];
                    if( !datasets.hasOwnProperty(crimeKey) 
                        && keys.indexOf(crimeKey) != -1 ) {
                            datasets[crimeKey] = { yAxisID: 'yAxis', label: prefix+' '+crimeKey, data: [], tension: 0.2 };
                    }
                    if( keys.indexOf(crimeKey) != -1 ) {
                        datasets[crimeKey].data.push([monthKey, crime]);
                    }

                })
            });
            return datasets;
        }
        promises.push(new Promise((resolve, reject) => {
            get( domain+'/COBRA/2020-aggregate.json', function(data) 
            {
                
                resolve(processData(data, '2020'));
            });
        }));
        promises.push(new Promise((resolve, reject) => {
            get( domain+'/COBRA/2019-aggregate.json', function(data) 
            {
                resolve(processData(data, '2019'));
            });
        }));
        var gaUnemployment = [
            3.1,
            3.5,
            3.7,
            12.2,
            9.5,
            8.7,
            8.1,
            7,
            6.4,
            5.4,
            5.3,
            5.6
        ];
        Promise.all( promises ).then((data) => {
            console.log({data});
            Chart.overrides.line.borderColor = [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(153, 192, 86, 1)',
                'rgba(75, 162, 132, 1)',
                'rgba(255, 102, 64, 1)',
                'rgba(54, 192, 64, 1)',
                'rgba(255,255,255, 1)',
                'rgba(0, 99, 255, 1)',
                'rgba(255, 0, 126, 1)'
            ];

            var ctx = document.querySelector('#crimeProtestsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    // labels: Object.keys(data[0]),
                    datasets: Object.values( data[0] ).concat( Object.values( data[1]), [{
                    yAxisID: 'yAxis2',
                    label: '2020 Unemployment',
                    data: Object.values(gaUnemployment)
                }] )
                },
                options: {
                    maintainAspectRatio: false,
                    elements: {
                        point: {
                            borderColor: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    scales: {
                        yAxis2: {
                            beginAtZero: true,
                            max: 20,
                            position: 'right',
                            title: {
                                display: true,
                                text: '% Unemployment (2020)',
                                color: 'rgba(153, 102, 255, 1)'
                            }
                        },
                        yAxis: {
                            title: {
                                text: 'Police Incidents per 10,000',
                                display: true
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 40
                            }
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'box',
                                    xMin: '06',
                                    xMax: '07',
                                    borderColor: 'rgb(255, 99, 132)',
                                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                                    borderWidth: 2,
                                    label: {
                                        content: 'Protests',
                                        enabled: true,
                                        color: '#fff'
                                    }
                                }
                            }
                        }
                    }
                }
            });
        });
    }
}
</script>